(()=>{"use strict";const t=(t,e)=>{const a=JSON.stringify(e);return t.some((function(t){return JSON.stringify(t)===a}))},e=function(e){let a=[];if(e.ships.forEach((t=>{t.isSunk()||t.hits.forEach((t=>{a.push(t)}))})),a.length<1)return;const r=[];a.forEach((t=>{((t,e)=>t[1]+1<10&&!e.board[t[1]+1][t[0]].isHit||t[0]+1<10&&!e.board[t[1]][t[0]+1].isHit||t[1]-1>=0&&!e.board[t[1]-1][t[0]].isHit||t[0]-1>=0&&!e.board[t[1]][t[0]-1].isHit)(t,e)&&r.push(t)}));let o=r[0];const s=((e,a,r,o)=>{if(console.log(t(o,[e[0]+1,e[1]]),o),t(r,[e[0],e[1]-1])||t(r,[e[0],e[1]+1])){for(e=r[0];e[1]-1>=0&&a.board[e[1]-1][e[0]].isHit&&e[1]+1<10&&a.board[e[1]+1][e[0]].isHit&&r.indexOf(e)<r.length-1;){const t=r.indexOf(e);e=r[t+1]}if(e[1]+1<10&&a.board[e[1]+1][e[0]].isHit&&e[1]-1>=0&&!a.board[e[1]-1][e[0]].isHit)return a.recieveAttack(e[0],e[1]-1),[e[0],e[1]-1];if(e[1]-1>=0&&a.board[e[1]-1][e[0]].isHit&&e[1]+1<10&&!a.board[e[1]+1][e[0]].isHit)return a.recieveAttack(e[0],e[1]+1),[e[0],e[1]+1]}else if(t(o,[e[0]-1,e[1]])||t(o,[e[0]+1,e[1]])){for(e=r[0];e[0]-1>=0&&a.board[e[1]][e[0]-1].isHit&&e[0]+1<10&&a.board[e[1]][e[0]+1].isHit&&r.indexOf(e)<r.length-1;){const t=r.indexOf(e);e=r.splice(t,1)[0]}if(e[0]+1<10&&a.board[e[1]][e[0]+1].isHit&&e[0]-1>=0&&!a.board[e[1]][e[0]-1].isHit)return a.recieveAttack(e[0]-1,e[1]),[e[0]-1,e[1]];if(e[0]-1>=0&&a.board[e[1]][e[0]-1].isHit&&e[0]+1<10&&!a.board[e[1]][e[0]+1].isHit)return a.recieveAttack(e[0]+1,e[1]),[e[0]+1,e[1]]}return!1})(o,e,r,a);return s||(o[1]+1<10&&!e.board[o[1]+1][o[0]].isHit?(e.recieveAttack(o[0],o[1]+1),[o[0],o[1]+1]):o[0]+1<10&&!e.board[o[1]][o[0]+1].isHit?(e.recieveAttack(o[0]+1,o[1]),[o[0]+1,o[1]]):o[1]-1>=0&&!e.board[o[1]-1][o[0]].isHit?(e.recieveAttack(o[0],o[1]-1),[o[0],o[1]-1]):o[0]-1>=0&&!e.board[o[1]][o[0]-1].isHit?(e.recieveAttack(o[0]-1,o[1]),[o[0]-1,o[1]]):void 0)},a=class{constructor(t){this.name=t,this.ships=[],this.gameboard=new class{constructor(){this.board=this.#t(),this.missed=[],this.ships=[]}#t(){let t=[];for(let e=0;e<10;e++){let e=[];for(let t=0;t<10;t++)e.push({isHit:!1,hasShip:!1});t.push(e)}return t}placeShip(t,e,a,r){if(this.#e(e,a,t,r)){const o=[];for(let s=0;s<t;s++)"hori"===r&&(o.push([e+s,a]),this.board[a][e+s].hasShip=!0),"vert"===r&&(o.push([e,a+s]),this.board[a+s][e].hasShip=!0);const s=new class{constructor(t,e){this.name=t,this.location=e,this.hits=[]}hit(t){this.hits.push(t)}isSunk(){return this.location.sort().toString()===this.hits.sort().toString()}}("ship",o);return this.ships.push(s),s}return"Not a valid spot"}recieveAttack(t,e){if(this.board[e][t].hasShip){let a;for(let r=0;r<this.ships.length;r++)this.#a(this.ships[r].location,[t,e])&&(a=this.ships[r]);return a.hit([t,e]),this.board[e][t].isHit=!0,a.isSunk(),a.hits}return this.missed.push([t,e]),this.board[e][t].isHit=!0,this.missed}allShipsSunk(){let t=!0;return this.ships.forEach((e=>{e.isSunk()||(t=!1)})),t}#e(t,e,a,r){let o=!0;for(let s=0;s<a;s++)"hori"===r&&(0<=t+s&&t+s<10&&0<=e&&e<10?this.ships.forEach((a=>{this.#a(a.location,[t+s,e])&&(o=!1)})):o=!1),"vert"===r&&(0<=t&&t<10&&0<=e+s&&e+s<10?this.ships.forEach((a=>{this.#a(a.location,[t,e+s])&&(o=!1)})):o=!1);return o}#a(t,e){const a=JSON.stringify(e);return t.some((function(t){return JSON.stringify(t)===a}))}}}attack(t,e,a){if(a.board[e][t].isHit)return"You already shot there";a.recieveAttack(t,e)}autoAttack(t){const a=e(t);if(a)return a;const r=Math.round(9*Math.random()),o=Math.round(9*Math.random());return!t.board[o][r].isHit&&(t.recieveAttack(r,o),[r,o])}},r=()=>Math.floor(10*Math.random()),o=t=>{const e=document.createElement("div");e.classList.add("miss"),t.appendChild(e)},s=t=>{const e=document.createElement("div");e.classList.add("hit"),t.appendChild(e)},d=(t,e,a)=>{const r=t.location[0][0],o=t.location[0][1],s=l(t),d=document.querySelector(`.${a}[data-x="${r}"][data-y="${o}"]`),i=document.createElement("img");"vert"===s&&i.classList.add("vertical"),i.classList.add("playerShip"),0===e&&(i.classList.add("carrier"),i.classList.add("oppShip"),i.src="./resources/carrier.png"),1===e&&(i.classList.add("battleship"),i.classList.add("oppShip"),i.src="./resources/battleship.png"),2===e&&(i.classList.add("cruiser"),i.classList.add("oppShip"),i.src="./resources/cruiser.png"),3===e&&(i.classList.add("submarine"),i.classList.add("oppShip"),i.src="./resources/submarine.png"),4===e&&(i.classList.add("destroyer"),i.classList.add("oppShip"),i.src="./resources/destroyer.png"),d.appendChild(i),"oppCell"===a&&(i.style.opacity=0)},l=t=>t.location[0][0]===t.location[1][0]?"vert":"hori",i=function(){const t=new a("user"),e=[c,n,u,m,h];e.forEach((a=>{t.gameboard.placeShip(a[3],a[0],a[1],a[2]),d(t.gameboard.ships.slice(-1)[0],e.indexOf(a),"userCell")}));const l=new a("AI");let i=5;for(;5!==l.gameboard.ships.length;){const t=r(),e=r(),a=0===Math.round(Math.random())?"hori":"vert";1===l.gameboard.ships.length&&(i=4),2===l.gameboard.ships.length&&(i=3),3===l.gameboard.ships.length&&(i=3),4===l.gameboard.ships.length&&(i=2),l.gameboard.placeShip(i,t,e,a)}l.gameboard.ships.forEach((t=>{d(t,l.gameboard.ships.indexOf(t),"oppCell")})),document.querySelectorAll(".oppCell").forEach((e=>{e.addEventListener("click",(()=>{if(e.lastChild&&(e.lastChild.classList.contains("hit")||e.lastChild.classList.contains("miss")))return;const a=parseInt(e.getAttribute("data-x")),r=parseInt(e.getAttribute("data-y")),d=l.gameboard.missed.length;if(t.attack(a,r,l.gameboard),d<l.gameboard.missed.length)o(e);else if(s(e),l.gameboard.ships.forEach((t=>{t.isSunk()&&(t=>{const e=t.location[0][0],a=t.location[0][1];document.querySelector(`.oppCell[data-x="${e}"][data-y="${a}"]`).firstChild.style.opacity=.8})(t)})),l.gameboard.allShipsSunk())return document.querySelector(".endModal").style.display="flex",void(document.querySelector(".whoWon").textContent="CONGRATULATIONS. YOU SUNK ALL ENEMY SHIPS AND WON THE BATTLE!");const i=t.gameboard.missed.length;let c=l.autoAttack(t.gameboard);for(;!c;)c=l.autoAttack(t.gameboard);const n=document.querySelector(`.userCell[data-x="${c[0]}"][data-y="${c[1]}"]`);i<t.gameboard.missed.length?o(n):(s(n),t.gameboard.allShipsSunk()&&(document.querySelector(".endModal").style.display="flex",document.querySelector(".whoWon").textContent="ARGHH! THE ENEMY HAS SUNK ALL YOUR SHIPS AND YOU HAVE TO RETREAT. REGROUP AND TRY AGAIN.")),document.querySelector(".playAgain").addEventListener("click",(()=>{location.reload()}))}))}))};let c,n,u,m,h,p="hori",y=1;function S(t){if(6===y)return;const e=parseInt(t.getAttribute("data-x")),a=parseInt(t.getAttribute("data-y"));let r=document.querySelector(`.modalCell[data-x="${e+1}"][data-y="${a}"]`),o=document.querySelector(`.modalCell[data-x="${e+2}"][data-y="${a}"]`),s=document.querySelector(`.modalCell[data-x="${e+3}"][data-y="${a}"]`),d=document.querySelector(`.modalCell[data-x="${e+4}"][data-y="${a}"]`);"vert"===p&&(r=document.querySelector(`.modalCell[data-x="${e}"][data-y="${a+1}"]`),o=document.querySelector(`.modalCell[data-x="${e}"][data-y="${a+2}"]`),s=document.querySelector(`.modalCell[data-x="${e}"][data-y="${a+3}"]`),d=document.querySelector(`.modalCell[data-x="${e}"][data-y="${a+4}"]`));let l=[t,r,o,s,d];l=f(l);let i=!0,c=!1;l.forEach((t=>{t?t.classList.contains("occupied")&&(c=!0):i=!1})),i?(c&&t.classList.remove("placeError"),l.forEach((t=>{t.classList.remove("placeHover")})),t.firstChild&&t.classList.remove("alreadyPlacedError")):t.classList.remove("placeError")}function f(t){return 1===y?t:2===y?t.slice(0,4):3===y||4==y?t.slice(0,3):5===y?t.slice(0,2):void 0}document.querySelectorAll(".board").forEach((t=>{for(let e=0;e<10;e++){let a=document.createElement("div");for(let r=0;r<10;r++){let o=document.createElement("div");o.classList.add("cell"),t.classList.contains("opponent")&&o.classList.add("oppCell"),t.classList.contains("player")&&o.classList.add("userCell"),t.classList.contains("modalBoard")&&o.classList.add("modalCell"),o.dataset.x=r,o.dataset.y=e,a.appendChild(o)}a.classList.add("row"),t.appendChild(a)}})),(()=>{document.querySelectorAll(".modalCell").forEach((t=>{t.addEventListener("mouseenter",(()=>function(t){if(6===y)return;if(t.firstChild)return void t.classList.add("alreadyPlacedError");const e=parseInt(t.getAttribute("data-x")),a=parseInt(t.getAttribute("data-y"));let r=document.querySelector(`.modalCell[data-x="${e+1}"][data-y="${a}"]`),o=document.querySelector(`.modalCell[data-x="${e+2}"][data-y="${a}"]`),s=document.querySelector(`.modalCell[data-x="${e+3}"][data-y="${a}"]`),d=document.querySelector(`.modalCell[data-x="${e+4}"][data-y="${a}"]`);"vert"===p&&(r=document.querySelector(`.modalCell[data-x="${e}"][data-y="${a+1}"]`),o=document.querySelector(`.modalCell[data-x="${e}"][data-y="${a+2}"]`),s=document.querySelector(`.modalCell[data-x="${e}"][data-y="${a+3}"]`),d=document.querySelector(`.modalCell[data-x="${e}"][data-y="${a+4}"]`));let l=[t,r,o,s,d];l=f(l);let i=!0;l.forEach((t=>{t?t.classList.contains("occupied")&&(i=!1):i=!1})),i?l.forEach((t=>{t.classList.add("placeHover")})):t.classList.add("placeError")}(t))),t.addEventListener("mouseleave",(()=>S(t))),t.addEventListener("click",(()=>function(t){if(1===y){const e=parseInt(t.getAttribute("data-x")),a=parseInt(t.getAttribute("data-y"));let r=document.querySelector(`.modalCell[data-x="${e+1}"][data-y="${a}"]`),o=document.querySelector(`.modalCell[data-x="${e+2}"][data-y="${a}"]`),s=document.querySelector(`.modalCell[data-x="${e+3}"][data-y="${a}"]`),d=document.querySelector(`.modalCell[data-x="${e+4}"][data-y="${a}"]`);if("vert"===p&&(r=document.querySelector(`.modalCell[data-x="${e}"][data-y="${a+1}"]`),o=document.querySelector(`.modalCell[data-x="${e}"][data-y="${a+2}"]`),s=document.querySelector(`.modalCell[data-x="${e}"][data-y="${a+3}"]`),d=document.querySelector(`.modalCell[data-x="${e}"][data-y="${a+4}"]`)),!(r&&o&&s&&d))return;const l=[t,r,o,s,d];let i=!1;if(l.forEach((t=>{t.classList.contains("occupied")&&(i=!0)})),i)return;const n=document.createElement("img");return n.classList.add("carrier"),"vert"===p&&n.classList.add("vertical"),n.src="./resources/carrier.png",t.appendChild(n),l.forEach((t=>{t.classList.add("occupied")})),S(t),y++,document.querySelector(".modalTitle").textContent="PLACE YOUR BATTLESHIP",void(c=[e,a,p,5])}if(2===y){const e=parseInt(t.getAttribute("data-x")),a=parseInt(t.getAttribute("data-y"));let r=document.querySelector(`.modalCell[data-x="${e+1}"][data-y="${a}"]`),o=document.querySelector(`.modalCell[data-x="${e+2}"][data-y="${a}"]`),s=document.querySelector(`.modalCell[data-x="${e+3}"][data-y="${a}"]`);if("vert"===p&&(r=document.querySelector(`.modalCell[data-x="${e}"][data-y="${a+1}"]`),o=document.querySelector(`.modalCell[data-x="${e}"][data-y="${a+2}"]`),s=document.querySelector(`.modalCell[data-x="${e}"][data-y="${a+3}"]`)),!r||!o||!s)return;const d=[t,r,o,s];let l=!1;if(d.forEach((t=>{t.classList.contains("occupied")&&(l=!0)})),l)return;const i=document.createElement("img");return i.classList.add("battleship"),"vert"===p&&i.classList.add("vertical"),i.src="./resources/battleship.png",t.appendChild(i),d.forEach((t=>{t.classList.add("occupied")})),S(t),y++,document.querySelector(".modalTitle").textContent="PLACE YOUR CRUISER",void(n=[e,a,p,4])}if(3===y){const e=parseInt(t.getAttribute("data-x")),a=parseInt(t.getAttribute("data-y"));let r=document.querySelector(`.modalCell[data-x="${e+1}"][data-y="${a}"]`),o=document.querySelector(`.modalCell[data-x="${e+2}"][data-y="${a}"]`);if("vert"===p&&(r=document.querySelector(`.modalCell[data-x="${e}"][data-y="${a+1}"]`),o=document.querySelector(`.modalCell[data-x="${e}"][data-y="${a+2}"]`)),!r||!o)return;const s=[t,r,o];let d=!1;if(s.forEach((t=>{t.classList.contains("occupied")&&(d=!0)})),d)return;const l=document.createElement("img");return l.classList.add("cruiser"),"vert"===p&&l.classList.add("vertical"),l.src="./resources/cruiser.png",t.appendChild(l),s.forEach((t=>{t.classList.add("occupied")})),S(t),y++,document.querySelector(".modalTitle").textContent="PLACE YOUR SUBMARINE",void(u=[e,a,p,3])}if(4===y){const e=parseInt(t.getAttribute("data-x")),a=parseInt(t.getAttribute("data-y"));let r=document.querySelector(`.modalCell[data-x="${e+1}"][data-y="${a}"]`),o=document.querySelector(`.modalCell[data-x="${e+2}"][data-y="${a}"]`);if("vert"===p&&(r=document.querySelector(`.modalCell[data-x="${e}"][data-y="${a+1}"]`),o=document.querySelector(`.modalCell[data-x="${e}"][data-y="${a+2}"]`)),!r||!o)return;const s=[t,r,o];let d=!1;if(s.forEach((t=>{t.classList.contains("occupied")&&(d=!0)})),d)return;const l=document.createElement("img");return l.classList.add("submarine"),"vert"===p&&l.classList.add("vertical"),l.src="./resources/submarine.png",t.appendChild(l),s.forEach((t=>{t.classList.add("occupied")})),S(t),y++,document.querySelector(".modalTitle").textContent="PLACE YOUR DESTROYER",void(m=[e,a,p,3])}if(5===y){const e=parseInt(t.getAttribute("data-x")),a=parseInt(t.getAttribute("data-y"));let r=document.querySelector(`.modalCell[data-x="${e+1}"][data-y="${a}"]`);if("vert"===p&&(r=document.querySelector(`.modalCell[data-x="${e}"][data-y="${a+1}"]`)),!r)return;const o=[t,r];let s=!1;if(o.forEach((t=>{t.classList.contains("occupied")&&(s=!0)})),s)return;const d=document.createElement("img");d.classList.add("destroyer"),"vert"===p&&d.classList.add("vertical"),d.src="./resources/destroyer.png",t.appendChild(d),o.forEach((t=>{t.classList.add("occupied")})),S(t),y++,h=[e,a,p,2],document.querySelector(".placeModal").style.display="none",i()}}(t)))}));const t=document.querySelector(".changeAxis");t.addEventListener("click",(()=>{"X"===t.textContent.charAt(6)?(t.textContent="AXIS: Y",p="vert"):(t.textContent="AXIS: X",p="hori")}))})()})();